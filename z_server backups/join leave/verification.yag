
{{/* VERIFICATION LOGGING 
Regex trigger: \A
Set it to only run in main talk channel
*/}}


{{$verified := 1048764993925034065}} {{/* verified role ID */}}
{{$main := 750541618389712900}}{{/* main talk channel */}}
{{$id := .Message.Author.ID}} {{/* User ID of person who entered server */}}
{{$joins := 954832185200898128}} {{/* joins-leaves modlog channel - for successful verifications */}}
{{$modlog := 970007312632795167 }} {{/* yag-cmd-log */}}
{{$intros := 1033952269265272863}}

{{$v := "☑️"}}{{/* emoji to verify */}}


{{if and (eq .Channel.ID $main) (eq .Message.Type 7)}}
        
    {{addRoleID $verified}}
    {{deleteTrigger 1}}
    {{$announce := (complexMessage "content" (print "<@" $id "> 🥳") "embed" (cslice (cembed "thumbnail" (sdict "url" "https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/google/350/confetti-ball_1f38a.png") "color" 43775 "description"  (print "**Welcome to BentoVid, <@" $id ">!**\nFeel free to jump in any time!")) (cembed "color" 16744192 "description" "**Optional things to do**\n\n 🔸 Add <#750544674011349053>\n 🔸 Create your <#" $intros ">\n 🔸 `/birthday register` in <#1019933777826426940> / [Public Testing](https://discord.com/channels/750541618389712896/1047909689310052392)\n 🔸 Read <#1049023382680784978>\n\n[More Server Guides](https://bentovid.com/sguides)" )) )}}

    {{sendMessage $main $announce }}


    {{/* SENDS VERIFICATION TO Joins-Leaves */}}
            
    {{ $VerifyMsg := (print "🎗️ \n🟨 **<@" $id "> ("  .Message.Author ") Verified.** \n🟨 (ID: " $id ") \n🟨 <t:" currentTime.Unix ">\n🟨 **Time Taken: " (humanizeDurationHours (currentTime.Sub .Member.JoinedAt.Parse)) "** \n*Membercount: " .Guild.MemberCount "*" ) }}

    {{ sendMessage $joins $VerifyMsg }}

    {{/* update verification / joindate db */}}

    {{$vcdb := (dbGet 0 "vcount").Value}}
    {{dbSet 0 "vcount" (add 1 $vcdb)}}

    {{$jdb := (dbGet .User.ID "joindate")}}
    {{if $jdb}}
        {{$jinfo := sdict
        "joined" $jdb.Value.joined
        "vdate" (print "<t:" currentTime.Unix ">")
        "left" $jdb.Value.left
        }}
        {{dbSet .User.ID "joindate" $jinfo}}
    {{else}}
        {{dbSet .User.ID "joindate" (sdict "joined" (print (humanizeDurationHours (currentTime.Sub .Member.JoinedAt.Parse)) " ago" ) "vdate" (print "<t:" currentTime.Unix ">") "left" "Never" ) }}
    {{end}}
{{end}}